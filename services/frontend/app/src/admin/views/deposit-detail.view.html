<div ng-controller="DepositDetailController as ctrl"
     ng-init="ctrl.getData()">
  <section class="text-large">
    <h1>Информация о вкладе</h1>
    <hr class="primary">

    <div class="row-offset-0">
      <ul class="list-group">
        <li class="list-group-item" ng-if="user.isAdmin()">
          Клиент:
            <a href="/clients/{{ctrl.deposit.client.id}}/">
            {{ctrl.deposit.client.first_name}}
          </a>
        </li>
        <li class="list-group-item">
          План:
            <a href="/deposit-templates/{{ctrl.deposit.template.id}}/">
              {{ctrl.deposit.template.name}}
            </a>
        </li>
        <li class="list-group-item">
          Статус: {{ctrl.depositStatuses[ctrl.deposit.status]}}
          <span ng-if="ctrl.canClose()">
            <button class="btn button button-info" ng-click="ctrl.close()">Закрыть</button>
          </span>
        </li>
        <li class="list-group-item">
          Активен: {{ctrl.deposit.is_active ? "Да" : "Нет"}}
        </li>
        <li class="list-group-item">
          Остаток: {{ctrl.deposit.amount}} {{ctrl.deposit.amount_currency}}
        </li>
        <li class="list-group-item">
          Открыт: {{ctrl.deposit.start_date | date : 'dd.MM.yyyy'}}
        </li>
        <li  class="list-group-item" ng-if="ctrl.deposit.description">
          Описание: <p>{{ctrl.deposit.description}}</p>
        </li>
      </ul>

      <div ng-if="ctrl.canResolveCreate()">
        <div class="panel panel-info">
          <div class="panel-heading">
            <h3 class="panel-title">Подтверждение заявки на создание</h3>
          </div>
          <div class="panel-body">
            <form ng-submit="ctrl.resolveCreateClaim(value, cause)" ng-init="value='true'">
              <div class="form-group">
                  <div class="radio">
                    <label>
                      <input type="radio" ng-model="value" name="resolve" value="true">
                      Подтвердить
                    </label>
                  </div>
                  <div class="radio">
                    <label>
                      <input type="radio" ng-model="value" name="resolve">
                      Отклонить
                    </label>
                  </div>
                </div>
                <div class="form-group" ng-if="!value">
                  <label for="create-cause-control">Причина:</label>
                  <textarea id="create-cause-control"
                            class="form-control"
                            ng-model="cause"></textarea>
                </div>

              <div class="form-group">
                  <div class="row-offset-0 col-md-2">
                    <button type="submit"
                            class="form-control btn btn-info button">
                      Отправить
                    </button>
                  </div>
                </div>
            </form>
          </div>
        </div>
      </div>

      <div ng-if="ctrl.canResolveClose()">
        <div class="panel panel-info">
          <div class="panel-heading">
            <h3 class="panel-title">Подтверждение заявки на закрытие</h3>
          </div>
          <div class="panel-body">
            <form ng-submit="ctrl.resolveCloseClaim(value, cause)" ng-init="value='true'">
              <div class="form-group">
                  <div class="radio">
                    <label>
                      <input type="radio" ng-model="value" name="resolve" value="true">
                      Подтвердить
                    </label>
                  </div>
                  <div class="radio">
                    <label>
                      <input type="radio" ng-model="value" name="resolve">
                      Отклонить
                    </label>
                  </div>
                </div>
                <div class="form-group" ng-if="!value">
                  <label for="close-cause-control">Причина:</label>
                  <textarea id="close-cause-control"
                            class="form-control"
                            ng-model="cause"></textarea>
                </div>

              <div class="form-group">
                  <div class="row-offset-0">
                    <button type="submit"
                            class="form-control btn btn-success">
                      <span class="glyphicon glyphicon-ok"></span>
                      Отправить
                    </button>
                  </div>
                </div>
            </form>
          </div>
        </div>
    </div>

      <div ng-if="user.isClient() && ctrl.deposit.status == 0">
        <div class="panel panel-info">
          <div class="panel-heading">
            <h3 class="panel-title">Закрытие вклада</h3>
          </div>

            <form class="col-md-12" ng-submit="ctrl.close(account_id)">
              <div class="form-group">
                <label for="account-control">Счет:</label>
                <select class="form-control"
                        required
                        ng-model="account_id"
                        id="account-control">
                  <option></option>
                  <option ng-repeat="account in ctrl.accounts" value="{{account.id}}">
                    {{account.number}}
                    ({{ctrl.accountStatuses[account.status]}},
                    Остаток: {{account.residue}} {{account.residue_currency}})
                  </option>
                </select>
              </div>

              <div class="form-group">
                <div class="row-offset-0">
                  <button type="submit"
                          class="form-control btn btn-success">
                    <span class="glyphicon glyphicon-ok"></span>
                    Отправить заявку
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
  </section>
</div>